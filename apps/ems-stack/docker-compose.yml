services:
  postgres:
    image: postgres:16-alpine
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-ems}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-ems}
      POSTGRES_DB: ${POSTGRES_DB:-ems}
    volumes:
      - ems_pgdata:/var/lib/postgresql/data

  ems-api:
    build:
      context: ../../apps/ems-api
      dockerfile: Dockerfile
    environment:
      DATABASE_URL: postgres://${POSTGRES_USER:-ems}:${POSTGRES_PASSWORD:-ems}@postgres:5432/${POSTGRES_DB:-ems}
      EMS_JWT_SECRET: ${EMS_JWT_SECRET:-dev-secret-change-me}
      EMS_JWT_ISSUER: ${EMS_JWT_ISSUER:-xyn-ems}
      EMS_JWT_AUDIENCE: ${EMS_JWT_AUDIENCE:-ems}
    depends_on:
      - postgres
    expose:
      - "8000"

  ems-web:
    build:
      context: ${XYN_UI_PATH:-../../xyn-ui/apps/ems-ui}
      dockerfile: Dockerfile
    ports:
      - "${EMS_PUBLIC_PORT:-8080}:8080"
    depends_on:
      - ems-api

volumes:
  ems_pgdata: {}
